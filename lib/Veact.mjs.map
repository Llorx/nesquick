{"version":3,"file":"Veact.mjs","sources":["../src/VeactState/index.ts","../src/Veact/index.ts"],"sourcesContent":["declare global {\r\n    interface Object {\r\n        val<T>(this:T):VeactState.ReturnReturnType<T>;\r\n    }\r\n}\r\n\r\nexport namespace VeactState {\r\n    export interface Prop {\r\n        proxified:Map<string|number|Symbol, Prop>;\r\n        value:any;\r\n        realValue:any;\r\n        dirty:boolean;\r\n        cbs:Set<Sub>;\r\n        prop:string|number|Symbol;\r\n    }\r\n    export interface Sub {\r\n        oldProps:Set<Prop>;\r\n        props:Set<Prop>;\r\n        animated:boolean;\r\n        cb:() => void;\r\n        prerunning:Sub|null;\r\n        paused:boolean;\r\n        dirty:boolean;\r\n    }\r\n\r\n    export const IS_PROXY = Symbol(\"IS_PROXY\");\r\n    export const GET_VALUE = Symbol(\"GET_VALUE\");\r\n\r\n    let runningSub:Sub|null = null;\r\n    let subs:WeakMap<() => void, Sub> = new WeakMap();\r\n    let animation:number|null = null;\r\n    let subsAnimated:Set<Sub> = new Set();\r\n    let cbsAnimated:Set<() => void> = new Set();\r\n    function runSub(sub:Sub) {\r\n        sub.animated = false;\r\n        sub.oldProps = new Set(sub.props);\r\n        sub.prerunning = runningSub;\r\n        runningSub = sub;\r\n        sub.cb();\r\n        runningSub = sub.prerunning;\r\n        sub.prerunning = null;\r\n        for (let p of sub.oldProps) {\r\n            p.cbs.delete(sub);\r\n            sub.props.delete(p);\r\n            if (p.cbs.size === 0) {\r\n                p.proxified.delete(p.prop);\r\n            }\r\n        }\r\n    }\r\n    function runRender() {\r\n        for (let sub of subsAnimated) {\r\n            subsAnimated.delete(sub);\r\n            runSub(sub);\r\n        }\r\n        for (let cb of cbsAnimated) {\r\n            cbsAnimated.delete(cb);\r\n            cb();\r\n        }\r\n        if (subsAnimated.size > 0) {\r\n            runRender(); // This runs inside requestAnimationFrame tick\r\n        } else {\r\n            animation = null;\r\n        }\r\n    }\r\n    function renderSub(sub:Sub) {\r\n        if (sub.paused) {\r\n            sub.dirty = true;\r\n        } else if (!sub.animated) {\r\n            sub.animated = true;\r\n            subsAnimated.add(sub);\r\n            if (animation === null) {\r\n                animation = requestAnimationFrame(runRender);\r\n            }\r\n        }\r\n    }\r\n    function renderCb(callback:() => void) {\r\n        cbsAnimated.add(callback);\r\n        if (animation === null) {\r\n            animation = requestAnimationFrame(runRender);\r\n        }\r\n    }\r\n\r\n    export function disableSub() {\r\n        let disabledSub = runningSub;\r\n        runningSub = null;\r\n        return disabledSub;\r\n    }\r\n    export function enableSub(sub:Sub|null) { // Always needs to be called after disabling, inside same tick\r\n        runningSub = sub;\r\n    }\r\n\r\n    export function pause(sub:Sub) {\r\n        sub.paused = true;\r\n        if (sub.animated) {\r\n            sub.dirty = true;\r\n            cancelAnimation(sub);\r\n        }\r\n    }\r\n    export function resume(sub:Sub) {\r\n        sub.paused = false;\r\n        if (sub.dirty) {\r\n            sub.dirty = false;\r\n            renderSub(sub);\r\n        }\r\n    }\r\n\r\n    export function draw(callback:() => void) {\r\n        renderCb(callback);\r\n    }\r\n\r\n    export function render(callback:() => void) {\r\n        let sub = subs.get(callback);\r\n        if (!sub) {\r\n            subs.set(callback, sub = {\r\n                oldProps: new Set(),\r\n                props: new Set(),\r\n                animated: false,\r\n                cb: callback,\r\n                prerunning: null,\r\n                paused: false,\r\n                dirty: false\r\n            });\r\n        }\r\n        renderSub(sub);\r\n        return sub;\r\n    }\r\n\r\n    function cancelAnimation(sub:Sub) {\r\n        sub.animated = false;\r\n        subsAnimated.delete(sub);\r\n        if (subsAnimated.size == 0) {\r\n            cancelAnimationFrame(animation as number);\r\n            animation = null;\r\n        }\r\n    }\r\n\r\n    export function cancel(sub:Sub) {\r\n        if (sub.animated) {\r\n            cancelAnimation(sub);\r\n        }\r\n        for (let p of sub.props) {\r\n            p.cbs.delete(sub);\r\n        }\r\n    }\r\n\r\n    const map:WeakMap<any, any> = new WeakMap();\r\n    export function proxy(obj:any) {\r\n        return map.get(obj) || obj;\r\n    }\r\n    export function value(obj:any) {\r\n        return (obj && obj[IS_PROXY]) ? obj[GET_VALUE] : obj; // Not \"obj[GET_VALUE] || obj\" because the returned value can be falsy\r\n    }\r\n\r\n    Object.defineProperties(Function.prototype, {\r\n        val: {\r\n            value() {\r\n                let v = this();\r\n                return v ? v.val() : v;\r\n            },\r\n            enumerable: false\r\n        }\r\n    });\r\n    Object.defineProperties(Object.prototype, {\r\n        val: {\r\n            value() {\r\n                return this\r\n            },\r\n            enumerable: false\r\n        }\r\n    });\r\n    export type ReturnReturnType<T> = T extends (...args:any) => infer R ? ReturnReturnType<R> : T;\r\n\r\n    export function stateNoOptions<T>(st:T) { // To avoid some branching\r\n        if (st && typeof st === \"object\" && !(st as any)[IS_PROXY]) {\r\n            let r = map.get(st);\r\n            if (r) {\r\n                st = r;\r\n            } else {\r\n                let proxified:Map<string|number|Symbol, Prop> = new Map();\r\n                let obj = st;\r\n                st = new Proxy(st as Object, {\r\n                    get: (target, prop) => {\r\n                        if (prop === IS_PROXY) {\r\n                            return true;\r\n                        } else if (prop === GET_VALUE) {\r\n                            return obj;\r\n                        } else {\r\n                            let p = proxified.get(prop);\r\n                            if (!p) {\r\n                                let v = (target as any)[prop];\r\n                                proxified.set(prop, p = {\r\n                                    proxified: proxified,\r\n                                    value: stateNoOptions(v),\r\n                                    realValue: value(v),\r\n                                    dirty: false,\r\n                                    cbs: new Set(),\r\n                                    prop: prop\r\n                                });\r\n                            } else if (p.dirty) {\r\n                                p.dirty = false;\r\n                                p.value = stateNoOptions(p.value);\r\n                            }\r\n                            if (runningSub && !runningSub.oldProps.delete(p)) {\r\n                                p.cbs.add(runningSub);\r\n                                runningSub.props.add(p);\r\n                            }\r\n                            return p.value;\r\n                        }\r\n                    },\r\n                    set: (target, prop, v) => {\r\n                        let p = proxified.get(prop);\r\n                        if (p) {\r\n                            let isProxy = v && v[IS_PROXY];\r\n                            let realValue = isProxy ? v[GET_VALUE] : v;\r\n                            if (p.realValue !== realValue) {\r\n                                (target as any)[prop] = realValue;\r\n                                p.realValue = realValue;\r\n                                p.value = v;\r\n                                if (!isProxy) {\r\n                                    p.dirty = true;\r\n                                }\r\n                                for (let sub of p.cbs) {\r\n                                    renderSub(sub);\r\n                                }\r\n                            }\r\n                        } else {\r\n                            (target as any)[prop] = v;\r\n                        }\r\n                        return true;\r\n                    }\r\n                }) as T;\r\n                map.set(obj, st);\r\n            }\r\n        }\r\n        return st;\r\n    }\r\n\r\n    interface StateOptions<T> {\r\n        saveInterval:number;\r\n    }\r\n    interface StateOptionsLocal<T> extends StateOptions<T> {\r\n        syncKey:string;\r\n        onLoad?(state:T):any;\r\n    }\r\n    interface StateOptionsCustom<T> extends StateOptions<T> {\r\n        load(state:T):any;\r\n        save(state:T):any;\r\n    }\r\n\r\n    function JSONstringify(obj:any, objects:Map<any, any> = new Map()) {\r\n        let res = JSON.stringify(obj, (key, v) => {\r\n            let type = typeof v;\r\n            if (type === \"function\") {\r\n                return undefined;\r\n            }\r\n            return v;\r\n        });\r\n        return res;\r\n    }\r\n    /*function JSONparse<T>(ret:T, obj:any) {\r\n        for (let [k, v] of Object.entries(obj)) {\r\n            if (v && typeof v === \"object\") {\r\n                if (!ret[k]) {\r\n                    ret[k] = Array.isArray(v) ? [] : {};\r\n                }\r\n                JSONparse(ret[k], v);\r\n            } else {\r\n                ret[k] = v;\r\n            }\r\n        }\r\n    }*/\r\n\r\n    export function state<T>(st:T, options?:StateOptionsLocal<T>|StateOptionsCustom<T>) {\r\n        /*let loaded = false;\r\n        if (options) {\r\n            if (\"syncKey\" in options || \"save\" in options) {\r\n                let save = async () => {\r\n                    if (\"syncKey\" in options) {\r\n                        localStorage.setItem(options.syncKey, JSONstringify(ret));\r\n                    }\r\n                    if (\"save\" in options) {\r\n                        options.save(ret);\r\n                    }\r\n                };\r\n                setInterval(save, options.saveInterval);\r\n                window.addEventListener(\"unload\", save);\r\n                if (\"syncKey\" in options) {\r\n                    window.addEventListener(\"storage\", (storage) => {\r\n                        if (storage.key === options.syncKey) {\r\n                            try {\r\n                                JSONparse(ret, JSON.parse(storage.newValue));\r\n                            } catch (e) {}\r\n                        }\r\n                    });\r\n                    try {\r\n                        JSONparse(st, JSON.parse(localStorage.getItem(options.syncKey)));\r\n                        loaded = true;\r\n                    } catch (e) {}\r\n                }\r\n            }\r\n        }*/\r\n        let ret = stateNoOptions(st);\r\n        /*if (options) {\r\n            if (\"load\" in options) {\r\n                options.load(ret);\r\n            }\r\n            if (\"syncKey\" in options && loaded) {\r\n                if (options.onLoad) {\r\n                    options.onLoad(ret);\r\n                }\r\n            }\r\n        }*/\r\n        return ret;\r\n    }\r\n}","import { VeactState } from \"../VeactState\";\r\n\r\nexport { VeactState };\r\nexport namespace Veact {\r\n    export interface Props {\r\n        [k:string]:any;\r\n    }\r\n    interface DynamicOptions<T extends Props> {\r\n        key?:(props:T) => any;\r\n    }\r\n    interface DynamicOptionsProps<T extends Props, TReturn extends Props> extends DynamicOptions<T> {\r\n        props:(props:T) => TReturn;\r\n    }\r\n    type N3Constructor<T = any> = new(props:T extends Props ? T : never, children:Children, type?:keyof JSX.IntrinsicElements) => T extends Props ? VeactElement<T> : VeactElement;\r\n    type DynamicElement = {data:any, i:number|null, element:VeactElement<any>};\r\n    type Dynamic = {constructor:N3Constructor, callback:() => any|any[], options:DynamicOptionsProps<any, Props>|DynamicOptions<any>, children:DynamicElement[], keys:Map<any, DynamicElement>|null};\r\n    const dynamic:WeakMap<N3Constructor[], Dynamic> = new WeakMap();\r\n    export type Sub<T> = T extends {[key:string]:any} ? T extends Array<any> ? T|(() => T) : {[K in keyof T]:T[K]|(() => T[K])} : T|(() => T);\r\n    export type SubAll<T> = T extends {[key:string]:any} ? {[K in keyof T]:SubAll<T[K]>} : T|(() => T);\r\n    export type Children = (string|Node|VeactElement|(() => string|Props|Props[]))[];\r\n    export function createElement<T extends JSX.Props>(type:keyof JSX.IntrinsicElements, props?:T, ...children:Children):VeactElement<T>;\r\n    export function createElement<T extends Props>(type:new(props:T, children:Children) => VeactElement<T>, props?:T, ...children:Children):VeactElement<T>;\r\n    export function createElement<T extends Props>(type:(props:T) => VeactElement<any>, props?:T, ...children:Children):VeactElement<T>;\r\n    export function createElement<T extends Props>(type:keyof JSX.IntrinsicElements|(new(props:T, children:Children) => VeactElement<T>)|((props:T) => VeactElement<any>), props?:T, ...children:Children) {\r\n        if (typeof type === \"string\") {\r\n            return new VeactElement(props, children, type);\r\n        } else if (type.prototype instanceof VeactElement) {\r\n            return new (type as typeof VeactElement)(props, children);\r\n        } else {\r\n            let el = new VeactElement(props, children);\r\n            el.render = type as ((props:T) => VeactElement);\r\n            return el;\r\n        }\r\n    }\r\n    \r\n    export class VeactElement<P extends Props = {}> {\r\n        static for<T extends Props|boolean>(this:N3Constructor<T>, callback:() => T|T[]):(typeof this)[];\r\n        static for<T extends Props|boolean>(this:N3Constructor<T>, callback:() => T|T[], options:T extends Props ? DynamicOptions<T> : undefined):(typeof this)[];\r\n        static for<T extends Props, TReturn extends Props>(this:N3Constructor<TReturn>, callback:() => T|T[], options:DynamicOptionsProps<T, TReturn>):(typeof this)[];\r\n        static for<T extends Props, TReturn extends Props>(this:N3Constructor<TReturn>, callback:() => T|T[], options?:DynamicOptionsProps<T, TReturn>) {\r\n            let list:(typeof this)[] = [];\r\n            dynamic.set(list, {\r\n                constructor: this,\r\n                callback: callback,\r\n                options: options || {},\r\n                children: [],\r\n                keys: (options && options.key) ? new Map() : null\r\n            });\r\n            return list;\r\n        };\r\n        private subs:Set<VeactState.Sub> = new Set();\r\n        private displaySub:VeactState.Sub|null = null;\r\n        private childrenElements:Set<VeactElement> = new Set();\r\n        private visible = true;\r\n        private parent:VeactElement|null = null;\r\n        private destroyed = false;\r\n        private parentVisible = true;\r\n        private _content:Element|null = null;\r\n        private onremove:VeactElement[]|null = null;\r\n        state:{[key:string]:any}|null = null;\r\n        constructor(readonly props:P|undefined, protected readonly children:Children = [], protected readonly type?:keyof JSX.IntrinsicElements) {}\r\n        protected draw(callback:() => void) {\r\n            let sub = VeactState.render(callback);\r\n            this.subs.add(sub);\r\n        }\r\n        private drawDisplay(callback:() => void) {\r\n            this.displaySub = VeactState.render(callback);\r\n        }\r\n        onRemove() {\r\n            this.remove();\r\n        }\r\n        remove() {\r\n            if (this._content && this._content.parentNode) {\r\n                this._content.parentNode.removeChild(this._content);\r\n            }\r\n            if (this.onremove) {\r\n                for (let c of this.onremove) {\r\n                    (c.removed as (()=>void))();\r\n                }\r\n            }\r\n        }\r\n        removed?() {}\r\n        private unsubscribe(onremove:(VeactElement)[] = []) {\r\n            if (this.displaySub) {\r\n                VeactState.cancel(this.displaySub);\r\n            }\r\n            for (let s of this.subs) {\r\n                VeactState.cancel(s);\r\n            }\r\n            for (let c of this.childrenElements) {\r\n                c.unsubscribe(onremove);\r\n            }\r\n            if (this.removed) {\r\n                onremove.push(this);\r\n            }\r\n            return onremove;\r\n        }\r\n        appendTo(el:ParentNode) {\r\n            el.append(this.node);\r\n            return this;\r\n        }\r\n        valueOf() {\r\n            return this.node;\r\n        }\r\n        onRender?() {};\r\n        get node():Element {\r\n            if (!this._content) {\r\n                if (this.state) {\r\n                    this.state = VeactState.state(this.state);\r\n                }\r\n                let sub = VeactState.disableSub();\r\n                let el = this.render(this.props);\r\n                if (el) {\r\n                    this.childrenElements.add(el);\r\n                    el.parent = this;\r\n                    this._content = el.node;\r\n                }\r\n                VeactState.enableSub(sub);\r\n                this.onRender && this.onRender();\r\n            }\r\n            return this._content as Element;\r\n        }\r\n        private pause() {\r\n            for (let sub of this.subs) {\r\n                VeactState.pause(sub);\r\n            }\r\n        }\r\n        private resume() {\r\n            for (let sub of this.subs) {\r\n                VeactState.resume(sub);\r\n            }\r\n        }\r\n        private pauseDisplay() {\r\n            if (this.displaySub) {\r\n                VeactState.pause(this.displaySub);\r\n            }\r\n        }\r\n        private resumeDisplay() {\r\n            if (this.displaySub) {\r\n                VeactState.resume(this.displaySub);\r\n            }\r\n        }\r\n        private setParentVisible(v:boolean) {\r\n            if (this.parentVisible !== v) {\r\n                this.parentVisible = v;\r\n                if (v) {\r\n                    this.resumeDisplay();\r\n                    if (this.visible) {\r\n                        this.resume();\r\n                    }\r\n                } else {\r\n                    if (this.visible) {\r\n                        this.pause();\r\n                    }\r\n                    this.pauseDisplay();\r\n                }\r\n                if (this.visible) {\r\n                    for (let c of this.childrenElements) {\r\n                        c.setParentVisible(v);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        private setVisible(v:boolean) {\r\n            this.visible = v;\r\n            if (this.parentVisible) {\r\n                if (v) {\r\n                    this.resume();\r\n                } else {\r\n                    this.pause();\r\n                }\r\n            }\r\n            for (let c of this.childrenElements) {\r\n                c.setParentVisible(v);\r\n            }\r\n        }\r\n        private setStyle(style:CSSStyleDeclaration, props:Props) {\r\n            for (let [k, v] of Object.entries(props)) {\r\n                if (v instanceof Function) {\r\n                    if (k === \"display\") {\r\n                        this.drawDisplay(((k:any, v:Function) => {\r\n                            let value = v();\r\n                            style[k] = value;\r\n                            let hidden = value === \"none\";\r\n                            if (this.visible === hidden) {\r\n                                this.setVisible(!hidden);\r\n                            }\r\n                        }).bind(this, k, v));\r\n                    } else {\r\n                        this.draw(((k:any, v:Function) => {\r\n                            style[k] = v();\r\n                        }).bind(this, k, v));\r\n                    }\r\n                } else {\r\n                    style[k as any] = v;\r\n                }\r\n            }\r\n        }\r\n        render(props?:P):VeactElement|null {\r\n            let el = document.createElement(this.type as keyof JSX.IntrinsicElements);\r\n            this._content = el;\r\n            if (this.props) {\r\n                for (let [k, v] of Object.entries(this.props)) {\r\n                    if (Array.isArray(v)) {\r\n                        let res:string[] = [];\r\n                        let draws:{i:number, cb:Function}[] = [];\r\n                        for (let i = 0; i < v.length; i++) {\r\n                            let vv = v[i];\r\n                            if (typeof vv === \"function\") {\r\n                                draws.push({\r\n                                    i: i,\r\n                                    cb: vv\r\n                                });\r\n                            } else {\r\n                                res.push(vv)\r\n                            }\r\n                        }\r\n                        if (draws.length) {\r\n                            this.draw(((draws:{i:number, cb:Function}[]) => {\r\n                                for (let v of draws) {\r\n                                    res[v.i] = v.cb();\r\n                                }\r\n                                el.setAttribute(k, (el as any)[k] = res.join(\"\"));\r\n                            }).bind(this, draws));\r\n                        } else {\r\n                            el.setAttribute(k, (el as any)[k] = res.join(\"\"));\r\n                        }\r\n                    } else if (typeof v === \"function\") {\r\n                        if (k.startsWith(\"on\") && k.charCodeAt(2) >= 65 && k.charCodeAt(2) <= 90) {\r\n                            el.addEventListener(k.substring(2).toLowerCase(), v);\r\n                        } else {\r\n                            this.draw(((k:string, v:Function) => {\r\n                                let value = (el as any)[k] = v();\r\n                                if (typeof value === \"string\") {\r\n                                    el.setAttribute(k, value);\r\n                                }/* else if (value === true) { // TODO:?\r\n                                    el.setAttribute(k, \"true\");\r\n                                } else if (value === false) {\r\n                                    el.removeAttribute(k);\r\n                                }*/\r\n                            }).bind(this, k, v));\r\n                        }\r\n                    } else if (k === \"style\") {\r\n                        this.setStyle(el.style, v);\r\n                    } else {\r\n                        (el as any)[k] = v;\r\n                        if (typeof v === \"string\") {\r\n                            el.setAttribute(k, v);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            this.appendChilds(this.children);\r\n            return null;\r\n        }\r\n        private createDynamicChild(data:Props, array:Dynamic) {\r\n            let p:DynamicElement = {\r\n                data: data,\r\n                i: null,\r\n                element: new array.constructor(array.options && \"props\" in array.options ? array.options.props(data) : data, [])\r\n            };\r\n            this.childrenElements.add(p.element); // Duplicated\r\n            p.element.parent = this;\r\n            return p;\r\n        }\r\n        private insertDynamicChild(node:Node, array:Dynamic|null, i:number, childrenData:{node:Node|null}[], pos:number) {\r\n            let next = array && array.children[i+1]; // Duplicated code below\r\n            if (next) {\r\n                (this._content as Element).insertBefore(node, next.element._content);\r\n            } else {\r\n                let next:Node|null = null;\r\n                for (let ii = pos+1; ii < childrenData.length && !next; ii++) {\r\n                    next = childrenData[ii].node;\r\n                }\r\n                if (next) {\r\n                    (this._content as Element).insertBefore(node, next);\r\n                } else {\r\n                    (this._content as Element).appendChild(node);\r\n                }\r\n            }\r\n        }\r\n        private removeChild(el:VeactElement) {\r\n            this.childrenElements.delete(el);\r\n        }\r\n        destroy() {\r\n            if (!this.destroyed) {\r\n                this.destroyed = true;\r\n                this.onremove = this.unsubscribe();\r\n                if (this.parent) {\r\n                    this.parent.removeChild(this);\r\n                }\r\n                this.onRemove();\r\n            }\r\n        }\r\n        protected appendChilds(children:Children) {\r\n            let childrenData:{node:Node|null}[] = []; // Object control to insert childs in creation order\r\n            for (let i = 0; i < children.length; i++) {\r\n                let c = children[i];\r\n                if (c instanceof Function) {\r\n                    let n:{node:Node|null} = {node: null};\r\n                    childrenData[i] = n;\r\n                    ((c, pos) => {\r\n                        let lastRes:Node;\r\n                        this.draw(() => {\r\n                            let res = c() as string;\r\n                            if (lastRes) {\r\n                                lastRes.nodeValue = res;\r\n                            } else {\r\n                                lastRes = document.createTextNode(res);\r\n                                n.node = lastRes;\r\n                                this.insertDynamicChild(lastRes, null, 0, childrenData, pos);\r\n                            }\r\n                        });\r\n                    })(c, i);\r\n                } else if (Array.isArray(c)) {\r\n                    let array = dynamic.get(VeactState.value(c));\r\n                    if (array) {\r\n                        let n:{node:Node|null} = {node: null};\r\n                        childrenData[i] = n;\r\n                        ((c, array, pos) => {\r\n                            this.draw(() => {\r\n                                let res = array.callback() as Props[];\r\n                                if (!Array.isArray(res)) {\r\n                                    res = res ? [res] : [];\r\n                                }\r\n                                let keyf = array.options.key;\r\n                                if (keyf) {\r\n                                    let arrayKeys = array.keys as Map<any, DynamicElement>;\r\n                                    let keys = new Map(arrayKeys);\r\n                                    for (let i = 0; i < res.length; i++) {\r\n                                        let data = res[i];\r\n                                        let key = keyf(data);\r\n                                        let p:DynamicElement;\r\n                                        if (!keys.delete(key)) {\r\n                                            p = this.createDynamicChild(data, array);\r\n                                            array.children.push(p);\r\n                                            arrayKeys.set(key, p);\r\n                                            this.insertDynamicChild(p.element.node, array, array.children.length, childrenData, pos); // PUSH. TODO: Allow ordering when using keys\r\n                                        }\r\n                                    }\r\n                                    for (let [key, p] of keys) {\r\n                                        arrayKeys.delete(key);\r\n                                        let el = p.element;\r\n                                        el.destroy();\r\n                                        (p.element as any) = null; // Clean memory\r\n                                    }\r\n                                    for (let i = 0; i < array.children.length; i++) {\r\n                                        let p = array.children[i];\r\n                                        if (!p.element) {\r\n                                            c.splice(i, 1);\r\n                                            array.children.splice(i--, 1);\r\n                                        } else if (p.i === null) {\r\n                                            c.splice(i, 0, p.element);\r\n                                            p.i = i;\r\n                                        }\r\n                                    }\r\n                                } else {\r\n                                    for (let i = 0; i < res.length; i++) {\r\n                                        let data = res[i];\r\n                                        let p = array.children[i];\r\n                                        if (!p) {\r\n                                            p = this.createDynamicChild(data, array);\r\n                                            c[i] = p.element;\r\n                                            array.children[i] = p;\r\n                                            this.insertDynamicChild(p.element.node, array, i, childrenData, pos);\r\n                                        } else {\r\n                                            if (p.data !== data) {\r\n                                                p.element.destroy();\r\n                                                p.data = data;\r\n                                                p.element = new array.constructor(array.options && \"props\" in array.options ? array.options.props(data) : data, []);\r\n                                                c[i] = p.element;\r\n                                                this.childrenElements.add(p.element);\r\n                                                p.element.parent = this;\r\n                                                this.insertDynamicChild(p.element.node, array, i, childrenData, pos);\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    if (res.length < array.children.length) {\r\n                                        for (let i = res.length; i < array.children.length; i++) {\r\n                                            let el = array.children[i].element;\r\n                                            el.destroy();\r\n                                        }\r\n                                        array.children.splice(res.length);\r\n                                        c.splice(res.length);\r\n                                    }\r\n                                }\r\n                                n.node = array.children.length > 0 ? array.children[0].element._content : null;\r\n                            });\r\n                        })(c, array, i);\r\n                    } else {\r\n                        childrenData[i] = this.appendChilds(c);\r\n                    }\r\n                } else if (c instanceof VeactElement) {\r\n                    if (!c.destroyed) {\r\n                        this.childrenElements.add(c);\r\n                        c.parent = this;\r\n                        let node = c.node;\r\n                        childrenData[i] = {node:node};\r\n                        (this._content as Element).appendChild(node);\r\n                    } else {\r\n                        childrenData[i] = {node:null};\r\n                    }\r\n                } else if (c != null) {\r\n                    if (!(c instanceof Node)) {\r\n                        c = document.createTextNode(String(c));\r\n                    }\r\n                    childrenData[i] = {node:c};\r\n                    (this._content as Element).appendChild(c);\r\n                }\r\n            }\r\n            return childrenData[0];\r\n        }\r\n    }\r\n    /*class N3SFragment extends N3SElement {\r\n        protected render():N3SElement {\r\n            let el = new DocumentPersistentFragment();\r\n            this.node = el;\r\n            this.appendChilds(this.children);\r\n            return null;\r\n        }\r\n    }*/\r\n}\r\ndeclare global {\r\n    namespace JSX {\r\n        type JSXEvent<T extends Event, T2 extends EventTarget> = T&{currentTarget:T2};\r\n        type JSXHTMLEvent<T extends EventTarget> = {[K in keyof HTMLElementEventMap as `on${Capitalize<K>}`]?:(e:JSXEvent<HTMLElementEventMap[K], T>) => void};\r\n        type JSXSVGEvent<T extends EventTarget> = {[K in keyof SVGElementEventMap as `on${Capitalize<K>}`]?:(e:JSXEvent<SVGElementEventMap[K], T>) => void};\r\n        interface Props<T extends EventTarget = HTMLElement> extends JSXHTMLEvent<T> {\r\n            [k:string]:any;\r\n            style?:StyleProps;\r\n        }\r\n        type StyleProps = {[K in keyof CSSStyleDeclaration]?:CSSStyleDeclaration[K] extends Function ? never : CSSStyleDeclaration[K]|(()=>CSSStyleDeclaration[K])};\r\n        type HTMLProps<T extends HTMLElement = HTMLElement> = Props<T>;\r\n        type SVGProps<T extends SVGElement = SVGElement> = Props<T>;\r\n        type JSXElements = {[K in keyof HTMLElementTagNameMap]:HTMLProps<HTMLElementTagNameMap[K]>}&{[K in keyof SVGElementTagNameMap]:SVGProps<SVGElementTagNameMap[K]>};\r\n\r\n        type Element = Veact.VeactElement;\r\n        //type ElementClass = DOM.N3SElement;\r\n        interface IntrinsicElements extends JSXElements {\r\n            // TODO: fragment\r\n        }\r\n        interface ElementAttributesProperty {\r\n            props: {};\r\n        }\r\n    }\r\n}"],"names":[],"mappings":"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"}